## Sacramento River Steady Example

This example demonstrates how to use the PI_DeepONet model to train a model on the Sacramento River steady state example. It has three directories:
- `data_generation`: Contains the scripts to generate the data for the example.
- `plotting`: Contains the scripts to plot the results of the example.
- `SacramentoRiver_steady_DeepONet`: Contains the scripts to train the SWE-DeepONet model (without the physics-informed loss).
- `SacramentoRiver_steady_PI_DeepONet`: Contains the scripts to train the PI-SWE-DeepONet model (with the physics-informed loss).

## Data Generation

The `data_generation` directory has two subdirectories:
- `gen_train_val_test_data`: Contains the scripts to generate the training, validation, and test data for the example.
- `out_of_distribution`: Contains the scripts to generate the out-of-distribution data for the example.

### Generating Training, Validation, and Test Data

Go to the `gen_train_val_test_data` directory. It has the following: 
- `base_case`: This is the base SRH-2D simulation case. It is a template for all other simulation cases where the three inlet discharges are varied.
- `cases`: This directory is generated by the script to contain all the simulation results in vtk format. For example, if there are 1000 simulation cases, there will be 1000 vtk files in the directory. These vtk files are further processed to generate the training, validation, and test data. 
- `simulations_config.json`: This file contains the configuration for the simulations. It has the following parts:
  - `parameter_specs`: Specification of the parameters to be generated by the `preprocess_SRH_2D_simulations.py` script.
  - `run_specs`: Specification of the runs using the generated parameters by the `run_SRH_2D_simulations.py` script.
  - `postprocessing_specs`: Specification of the postprocessing of the simulation results by the `postprocess_SRH_2D_simulations.py` script.

The data generation steps are as follows:
1. Run the `preprocess_SRH_2D_simulations.py` script to generate the parameters. The parameters will be saved in a JSON file, such as `sampledParameters_2025_11_14-11_40_47_AM.json`. The file name has time stamp to indicate the time when the parameters were generated. 
2. Note this sampled parameters file name and modify the `sampled_parameters_file` entry in the `simulations_config.json` file.
3. Run the `run_SRH_2D_simulations.py` script to run the simulations. The simulation results will be saved in the `cases/vtks` directory. The simulations can be run in parallel using multiple CPU cores.
4. Run the `postprocess_SRH_2D_simulations.py` script to postprocess the simulation results. The postprocessing will split the simulation results into training, validation, and test data. The training, validation, and test data will be processed, normalized, and summarized, and saved in the `data/DeepONet` and `data/PINN` directories.
    - In `data/DeepONet`, the training, validation, and test data will be saved in the `train`, `val`, and `test` directories, respectively. Each contains a HDF5 file `data.h5`. There is also a JSON file `all_DeepONet_stats.json` that contains the statistics and normalization specifications of all the data points.
    - In `data/PINN`, the following files will be generated: `pde_points.npy` and `pde_data.npy`. `pde_points.npy` contains the points where the PDE residuals are evaluated, and `pde_data.npy` contains additional data at the PDE points, such as bed elevation, bed slope, and Manning's $n$ value. Additionally, there are `boundary_points.npy` and `boundary_info.npy` files that contain the points and data at the boundary points. **NOTE: currently boundary conditions are not implemented in the PINN model**. There is also a JSON file `all_PINN_stats.json` that contains the statistics and normalization specifications of all the data points.
5. Copy the `data` directory to the PI_DeepONet case directory. It will be used to train/validate/test the PI-SWE-DeepONet model. The `data/PINN` directory will be used only when the physics-informed loss is turned on in the training of the PI-SWE-DeepONet model.


### Generating Out-of-Distribution Data

Go to the `out_of_distribution` directory. It is similar to the `gen_train_val_test_data` directory, but with a different set of parameters (parameters outside the range of the training, validation, and test data). Specifically, it has the following:
- `base_case`: This is the base SRH-2D simulation case. It is a template for all other simulation cases where the three inlet discharges are varied.
- `cases`: This directory is generated by the script to contain all the simulation results in vtk format. For example, if there are 1000 simulation cases, there will be 1000 vtk files in the directory. These vtk files are further processed to generate the out-of-distribution data.
- `simulations_config.json`: This file contains the configuration for the simulations. The content is similar to the same file in the `gen_train_val_test_data` directory.
- `preprocess_SRH_2D_simulations.py`: This script generates the parameters for the out-of-distribution data. 
- `run_SRH_2D_simulations.py`: This script runs the simulations for the out-of-distribution data.
- No need to run `postprocess_SRH_2D_simulations.py`: We only need the generated out-of-distribution parameters file and the simulation results vtk files. The processing of application branch inputs and trunk inputs are done in the model_application.py script. In the future, it makes sense to do it here with the `postprocess_SRH_2D_simulations.py` script.