# Configuration for PI_SWE_DeepONet model

# Device configuration
device:
  type: "cuda"  # Set which device to use, "cuda" for GPU, "cpu" for CPU
  index: 0   # Specify which GPU to use if multiple GPUs are available

# Architecture
model:
  name: "PI_SWE_DeepONet"
  use_physics_loss: false  # Whether to enable physics-informed loss computation
  branch_net:
    hidden_layers: [64, 128, 256, 256, 128, 64]
    activation: "relu"
    dropout_rate: 0.0
    branch_input_dim: 3  # Number of sensors (input functions)
  trunk_net:
    hidden_layers: [64, 128, 256, 256, 128, 64]
    activation: "relu"
    dropout_rate: 0.0
    trunk_input_dim: 2  # (x, y) coordinates
  output_dim: 3  # h (water depth), u (x-velocity), v (y-velocity)  
  pinn_loss_flags:         #loss flags for the physics part
    bPDE_loss: true        #whether to include the PDEs loss in the loss function 

# Physics parameters
physics:
  unit: "SI"  # Unit, SI or EN. It should be the same as the output unit.
  bSteady: true           #whether the problem is steady or transient.
  gravity: 9.81  # Gravitational acceleration (m/s^2)  

  scales:        #physical scales for normalizing the PDEs
    length: 10.0  # Length scale (e.g., averaged water depth)
    velocity: 1.2  # Velocity scale (e.g., averaged velocity)
    
# Training parameters
training:
  batch_size: 16384
  epochs: 1000
  save_freq: 10
  learning_rate: 0.001
  weight_decay: 1e-5
  scheduler:
    use_scheduler: true
    scheduler_type: "ReduceLROnPlateau"
    patience: 10
    factor: 0.5
    min_lr: 1e-6
  early_stopping:
    use_early_stopping: true
    patience: 30
    min_delta: 1e-5
  loss_weights:
    # Adaptive loss balancing: automatically adjust weights to balance loss scales
    # Set to true to enable automatic balancing based on initial loss magnitudes
    # When enabled, the base weights below are multiplied by balancing factors
    use_adaptive_balancing: true  # Recommended: true for better training stability
    use_adaptive_pde_component_balancing: false  # Balance continuity vs momentum losses (recommended: true)
    adaptive_balancing_frequency: 10  # Update weights every N epochs throughout training (recommended: 10)
    # If adaptive_balancing_frequency is not specified, uses old behavior:
    # adaptive_balancing_epochs: 10  # Only update weights during first N epochs (deprecated, use frequency instead)
    
    # Base loss weights (before adaptive balancing)
    # Note: If adaptive balancing is enabled, these are starting weights that will be adjusted
    # If adaptive balancing is disabled, these are the final weights used throughout training
    deeponet:
      data_loss: 1.0      # Weight for DeepONet data loss
      pinn_loss: 1.0     # Weight for physics PDE loss 
      boundary_loss: 1.0
      initial_loss: 1.0
    pinn:
      data_loss: 1.0
      pde_loss: 1.0
      boundary_loss: 1.0
      initial_loss: 1.0
    # Weights for individual PDE component losses (continuity, momentum_x, momentum_y)
    # These are balanced automatically if use_adaptive_pde_component_balancing is true
    pde:
      continuity: 1.0     # Weight for continuity equation loss
      momentum_x: 1.0     # Weight for x-momentum equation loss
      momentum_y: 1.0     # Weight for y-momentum equation loss
  logging:
    tensorboard_log_dir: "./logs/tensorboard" # Save tensorboard logs to this directory
    save_freq: 100           # Save checkpoint every N epochs
    checkpoint_dir: "./checkpoints" # Save checkpoint to this directory
    print_freq: 1            # Print progress every N epochs
    

# Data parameters
data:
  pinn: 
    points_dir: "data/PINN"    #for the physics part of the PI-DeepONet
  deeponet:
    train_data_path: "data/DeepONet/train"
    val_data_path: "data/DeepONet/val"
    test_data_path: "data/DeepONet/test"  
    train_val_test_stats_path: "data/DeepONet/all_DeepONet_stats.json"  # Path to the dataset mean and std file (for normalization/denormalization purposes)
  nCells: 5036  # Number of cells in the SRH-2D cases
  template_vtk_file: "data/case.vtk"  # Template vtk file for the data generation (test cases)

# Application parameters
application:
  application_dir: "application"
  application_parameters_file: "applicationParameters.dat"
  training_parameters_file: "sampledParameters_2025_11_14-11_40_47_AM.dat"
  application_vtk_file: "case.vtk"   # The vtk file that contains the application mesh information
  model_checkpoint_file: "checkpoints/pi_deeponet_epoch_best.pt"
  train_val_test_stats_path: "all_DeepONet_stats.json"  # Path to the dataset mean and std file (for normalization/denormalization purposes)
